/*! russisk-skole 25-06-2015 */
function reverseSortBy(a){return function(b,c){var d=a(b),e=a(c);return void 0===d?-1:void 0===e?1:e>d?1:d>e?-1:0}}function getNextSaturday(){var a=6,b=new Date;return b.setDate(b.getDate()+(a+7-b.getDay())%7),console.log("next saturday: "+b),b}function formatDate(a){if(void 0==a||!(a instanceof Date))return"Ugyldig dato: "+a;var b=moment(a).format("DD. MMMM");return 0==b.indexOf("0")&&(b=b.substring(1,b.length)),b}function showMessage(a){$("#message").append(a).show()}function showError(a){$("#error").append(a).show()}function parseInput(a,b){var c=$(a).val(),d=c.split("\n"),e=[];for(i=0;i<d.length;i++){var f=d[i].split(b)[1].trim();e[i]=f}return e}function populateLinkList(a,b){b.fetch({success:function(b){var c=$(a);b.each(function(a){var b=a.get("done")?"done":"",d=a.get("order"),e=a.get("link"),f=a.get("name"),g="<div class='row "+b+"'>"+d+". <a target='_blank' href='"+e+"'>"+f+"</a></div>";c.append(g)})},error:function(a,b){alert("Error: "+b.code+" "+b.message)}})}Parse.initialize("bcUENToc9lcpbZqV94mjztZBOPHPqyNaEu5AEAaz","8gAHqXFZWMqt6BgRM0AOUfyfyLbfJQGmI06EtGQw");var TEACHERS=["Lena","Olga","Ira"],EVENTS=["fest","fridag"],COUNT=[1,2,3,4,5,6,7,8,9,10];moment.locale("ru");var WeekPlan=Parse.Object.extend("WeekPlan",{idAttribute:"objectId",saveChanges:function(){this.save({comments:this.get("comments"),small_kids:this.get("small_kids"),big_kids:this.get("big_kids"),where:this.get("where"),event:this.get("event")})},isNextTime:function(){var a=moment(new Date),b=moment(this.get("date"));b.hour(12),b.minute(0);var c=b.diff(a,"hours"),d=c>=0&&168>c;return d},isPast:function(){var a=moment(new Date),b=moment(this.get("date"));return moment(b).isBefore(a)},isInTheFuture:function(){return moment(this.get("date")).isAfter(new Date)},toJSON:function(){var a=_.clone(this.attributes),b="",c=this.get("event");void 0!=c&&(b=c.toLowerCase());var d={data:a,planId:this.id,formattedDate:formatDate(this.get("date")),formattedEvent:b,isNextTime:this.isNextTime(),isPast:this.isPast()};return d}}),WeekPlans=Parse.Collection.extend({model:WeekPlan,render:function(){this.model.toJSON();return $(this.el).html(this.template(this.model.toJSON())),this},countByName:function(a,b){return this.filter(function(c){if(void 0!=c.get(a)){b=b.toLowerCase();var d=c.get(a).toLowerCase()==b;return d}return!1})},getNextTime:function(){var a=this.filter(function(a){return a.isInTheFuture()});return a.length>0?a[0]:null},selectPastLessons:function(a){return filtered=this.filter(function(a){return a.isPast()}),new WeekPlans(filtered)},remaining:function(){return this.filter(function(a){return moment(a.get("date")).isAfter(new Date)})},comparator:function(a){return a.get("date")}}),AudioBook=Parse.Object.extend("AudioBooks",{idAttribute:"objectId",saveChanges:function(){this.save({name:this.get("name"),link:this.get("link"),order:this.get("order")})}}),AudioBooks=Parse.Collection.extend({model:AudioBook,render:function(){this.model.toJSON();return $(this.el).html(this.template(this.model.toJSON())),this},nextOrder:function(){return this.length?this.last().get("order")+1:1},comparator:function(a){return a.get("order")}}),ReadingBook=Parse.Object.extend("ReadingBooks",{idAttribute:"objectId",saveChanges:function(){this.save({})}}),ReadingBooks=Parse.Collection.extend({model:ReadingBook,render:function(){this.model.toJSON();return $(this.el).html(this.template(this.model.toJSON())),this},nextOrder:function(){return this.length?this.last().get("order")+1:1},getForChildren:function(a){return this.filter(function(b){return b.get("children")==a})},comparator:function(a){return a.get("order")}}),Movie=Parse.Object.extend("Movies"),Movies=Parse.Collection.extend({model:Movie,render:function(){this.model.toJSON();return $(this.el).html(this.template(this.model.toJSON())),this},nextOrder:function(){return this.length?this.last().get("order")+1:1},comparator:function(a){return a.get("order")}}),CommonWord=Parse.Object.extend("MostCommonWords"),CommonWords=Parse.Collection.extend({model:CommonWord,render:function(){this.model.toJSON();return $(this.el).html(this.template(this.model.toJSON())),this},nextOrder:function(){return this.length?this.last().get("order")+1:1},comparator:function(a){return a.get("order")}}),Book=Parse.Object.extend("Books",{idAttribute:"objectId",defaults:{lastUsed:"",unit:"side",countInClass:"",countHomework:""},saveChanges:function(){this.save({book:this.get("name"),unit:this.get("unit"),lastUsed:this.get("lastUsed"),countHomework:this.get("countHomework"),countAtClass:this.get("countAtClass")})},getNextClassTasks:function(){var a=parseInt(this.get("lastUsed")),b=parseInt(this.get("countInClass"));return a+b},getNextHomework:function(){var a=parseInt(this.get("lastUsed")),b=parseInt(this.get("countHomework"));return a+b},getDetailsForEditView:function(){var a=parseInt(this.get("lastUsed")),b=a+1,c=a+this.get("countInClass"),d=a+this.get("countHomework");return{from:b,toForClasswork:c,toForHomework:d,unit:this.get("unit")}},toJSON:function(){var a=Parse.Object.prototype.toJSON.call(this);a.lastUsed||(a.lastUsed=this.defaults.lastUsed),a.unit||(a.unit=this.defaults.unit),a.countInClass||(a.countInClass=this.defaults.countInClass),a.countHomework||(a.countHomework=this.defaults.countHomework);var b=parseInt(this.get("lastUsed")),c=b+1,d=b+this.get("countInClass"),e=b+this.get("countHomework");return a._from=c,a._toForClasswork=d,a._toForHomework=e,a}}),Books=Parse.Collection.extend({model:Book,render:function(){return $(this.el).html(this.template(this.model.toJSON())),this},comparator:function(a){return a.get("order")}}),Exercise=Parse.Object.extend("Exercise",{idAttribute:"objectId",defaults:{type:"",text:"",from:"",to:"",unit:""},isDoneBy:function(a){var b=this.get("doneBy");return void 0==b?!1:_.contains(b,a)},setDoneBy:function(a){var b=this.get("doneBy");void 0==b&&(b=[]);var c=_.contains(b,a);c?b=_.without(b,a):b.push(a);var d=_.clone(b);this.set("doneBy",d),this.save()},saveChanges:function(){this.save({book:this.get("book"),name:this.get("name"),link:this.get("link"),text:this.get("text"),from:this.get("from"),to:this.get("to"),doneBy:this.get("doneBy"),lessonDate:this.get("lessonDate")})},toJSON:function(){var a=Parse.Object.prototype.toJSON.call(this);return a.from||(a.from=this.defaults.from),a.to||(a.to=this.defaults.to),a.text||(a.text=this.defaults.text),a.name||(a.name=this.defaults.name),a.link||(a.link=this.defaults.link),a}}),Exercises=Parse.Collection.extend({model:Exercise,render:function(){return $(this.el).html(this.template(this.model.toJSON())),this},nextOrder:function(a,b){return this.length?this.last().get("order")+1:1},comparator:function(a){return a.get("order")}});